{% extends 'base.html' %}

{% block title %}{{ nino.nombre_completo }} - Detalle{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">
                <i class="bi bi-person-circle"></i> {{ nino.nombre_completo }}
            </h1>

            <!-- Botones de acción según rol -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Acciones Rápidas</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex flex-wrap gap-2">
                        <!-- Volver - Todos -->
                        <a href="{% url 'lista_ninos' %}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Volver
                        </a>
                        
                        <!-- Responsables - Todos pueden ver -->
                        <a href="{% url 'lista_responsables' nino.pk %}" class="btn btn-info">
                            <i class="bi bi-people-fill"></i> Responsables
                        </a>
                        
                        <!-- Registrar Asistencia - Admin y Maestros -->
                        {% if user.is_staff or user.is_superuser or user.groups.all.0.name == 'Maestro' %}
                            <a href="{% url 'registrar_asistencia' nino.pk %}" class="btn btn-success">
                                <i class="bi bi-calendar-check"></i> Registrar Asistencia
                            </a>
                        {% endif %}
                        
                        <!-- Solicitar Permiso - Padres -->
                        {% if puede_solicitar_permiso %}
                            <a href="{% url 'solicitar_permiso_ausencia' nino.pk %}" class="btn btn-warning">
                                <i class="bi bi-file-earmark-medical"></i> Solicitar Permiso
                            </a>
                        {% endif %}
                        
                        <!-- Asignar Aula - Solo Admin -->
                        {% if puede_asignar_aula %}
                            <a href="{% url 'asignar_aula' nino.pk %}" class="btn btn-primary">
                                <i class="bi bi-door-open-fill"></i> Asignar Aula/Maestro
                            </a>
                        {% endif %}
                        
                        <!-- Editar - Solo Admin -->
                        {% if puede_editar %}
                            <a href="{% url 'editar_nino' nino.pk %}" class="btn btn-warning">
                                <i class="bi bi-pencil-fill"></i> Editar
                            </a>
                        {% endif %}
                        
                        <!-- Eliminar - Solo Admin -->
                        {% if puede_editar %}
                            <a href="{% url 'eliminar_nino' nino.pk %}" class="btn btn-danger">
                                <i class="bi bi-trash-fill"></i> Eliminar
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Información Personal -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-person-fill"></i> Información Personal</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 text-center mb-3">
                            {% if nino.foto %}
                                <img src="{{ nino.foto.url }}" alt="{{ nino.nombre_completo }}" 
                                     class="img-fluid rounded-circle" style="max-width: 200px;">
                            {% else %}
                                <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center mx-auto" 
                                     style="width: 200px; height: 200px; font-size: 5rem;">
                                    <i class="bi bi-person-circle"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-9">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="200">Nombre Completo:</th>
                                    <td>{{ nino.nombre_completo }}</td>
                                </tr>
                                <tr>
                                    <th>Edad:</th>
                                    <td>{{ nino.edad }} años</td>
                                </tr>
                                {% if nino.fecha_nacimiento %}
                                <tr>
                                    <th>Fecha de Nacimiento:</th>
                                    <td>{{ nino.fecha_nacimiento|date:"d/m/Y" }}</td>
                                </tr>
                                {% endif %}
                                {% if nino.genero %}
                                <tr>
                                    <th>Género:</th>
                                    <td>{{ nino.get_genero_display }}</td>
                                </tr>
                                {% endif %}
                                <tr>
                                    <th>Estado:</th>
                                    <td>
                                        {% if nino.activo %}
                                            <span class="badge bg-success">Activo</span>
                                        {% else %}
                                            <span class="badge bg-danger">Inactivo</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Información del Responsable -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-person-badge-fill"></i> Responsable Principal</h5>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <th width="200">Nombre:</th>
                            <td>{{ nino.nombre_responsable }}</td>
                        </tr>
                        <tr>
                            <th>Parentesco:</th>
                            <td>{{ nino.parentesco }}</td>
                        </tr>
                        <tr>
                            <th>Teléfono:</th>
                            <td>
                                <a href="tel:{{ nino.telefono_responsable }}">
                                    <i class="bi bi-telephone-fill"></i> {{ nino.telefono_responsable }}
                                </a>
                            </td>
                        </tr>
                        {% if nino.email_responsable %}
                        <tr>
                            <th>Email:</th>
                            <td>
                                <a href="mailto:{{ nino.email_responsable }}">
                                    <i class="bi bi-envelope-fill"></i> {{ nino.email_responsable }}
                                </a>
                            </td>
                        </tr>
                        {% endif %}
                    </table>
                </div>
            </div>

            <!-- Perfil Médico -->
            <div class="card mb-4">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0"><i class="bi bi-heart-pulse-fill"></i> Perfil Médico</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                {% if nino.peso %}
                                <tr>
                                    <th width="150">Peso:</th>
                                    <td>{{ nino.peso }} kg</td>
                                </tr>
                                {% endif %}
                                {% if nino.altura %}
                                <tr>
                                    <th>Altura:</th>
                                    <td>{{ nino.altura }} cm</td>
                                </tr>
                                {% endif %}
                                {% if nino.tipo_sangre %}
                                <tr>
                                    <th>Tipo de Sangre:</th>
                                    <td><span class="badge bg-danger">{{ nino.tipo_sangre }}</span></td>
                                </tr>
                                {% endif %}
                            </table>
                        </div>
                        <div class="col-md-6">
                            {% if nino.tiene_alergias %}
                            <div class="alert alert-warning">
                                <strong><i class="bi bi-exclamation-triangle-fill"></i> Alergias:</strong>
                                <p class="mb-0 mt-2">{{ nino.alergias }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    {% if nino.enfermedades %}
                    <div class="alert alert-info">
                        <strong><i class="bi bi-clipboard-pulse"></i> Enfermedades:</strong>
                        <p class="mb-0 mt-2">{{ nino.enfermedades }}</p>
                    </div>
                    {% endif %}
                    
                    {% if nino.medicamentos %}
                    <div class="alert alert-primary">
                        <strong><i class="bi bi-capsule"></i> Medicamentos:</strong>
                        <p class="mb-0 mt-2">{{ nino.medicamentos }}</p>
                    </div>
                    {% endif %}
                    
                    {% if nino.observaciones_medicas %}
                    <div class="alert alert-secondary">
                        <strong><i class="bi bi-journal-medical"></i> Observaciones:</strong>
                        <p class="mb-0 mt-2">{{ nino.observaciones_medicas }}</p>
                    </div>
                    {% endif %}
                    
                    {% if nino.documento_medico %}
                    <div class="mt-3">
                        <a href="{{ nino.documento_medico.url }}" class="btn btn-sm btn-outline-primary" target="_blank">
                            <i class="bi bi-file-earmark-medical"></i> Ver Documento Médico
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Información de Aula (si está asignado) -->
            {% if nino.asignacion_aula %}
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-door-open-fill"></i> Asignación de Aula</h5>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <th width="200">Aula:</th>
                            <td>{{ nino.asignacion_aula.seccion.aula.nombre }}</td>
                        </tr>
                        <tr>
                            <th>Sección:</th>
                            <td>{{ nino.asignacion_aula.seccion.nombre }}</td>
                        </tr>
                        <tr>
                            <th>Maestro/a:</th>
                            <td>
                                {% if nino.asignacion_aula.seccion.maestro %}
                                    {{ nino.asignacion_aula.seccion.maestro.nombre_completo }}
                                {% else %}
                                    <span class="text-muted">Sin maestro asignado</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th>Fecha de Asignación:</th>
                            <td>{{ nino.asignacion_aula.fecha_asignacion|date:"d/m/Y H:i" }}</td>
                        </tr>
                    </table>
                </div>
            </div>
            {% endif %}

            <!-- Metadatos -->
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="bi bi-info-circle-fill"></i> Información del Registro</h5>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <th width="200">Fecha de Registro:</th>
                            <td>{{ nino.fecha_registro|date:"d/m/Y H:i" }}</td>
                        </tr>
                        <tr>
                            <th>Última Actualización:</th>
                            <td>{{ nino.fecha_actualizacion|date:"d/m/Y H:i" }}</td>
                        </tr>
                        {% if nino.usuario_registro %}
                        <tr>
                            <th>Registrado por:</th>
                            <td>{{ nino.usuario_registro.get_full_name|default:nino.usuario_registro.username }}</td>
                        </tr>
                        {% endif %}
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}